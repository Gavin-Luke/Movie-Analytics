import scrapy
import json

class TMDBSpider(scrapy.Spider):
    name = 'tmdb'
    api_key = 'YOUR_API_KEY'  

    def start_requests(self):
        for i in range(1, 60):  # Fetch multiple pages
            url = f'https://api.themoviedb.org/3/movie/popular?api_key={self.api_key}&language=en-US&page={i}'
            yield scrapy.Request(url=url, callback=self.parse)

    def parse(self, response):
        # Parse the JSON response
        movies = json.loads(response.body)

        for movie in movies['results']:
            movie_id = movie['id']
            yield scrapy.Request(
                url=f'https://api.themoviedb.org/3/movie/{movie_id}?api_key={self.api_key}&language=en-US',
                callback=self.parse_movie,
                meta={'movie_id': movie_id}
            )
   def parse_movie(self, response):
        data = json.loads(response.body)

        yield {
            'title': data.get('title', 'NULL'),
            'release_date': data.get('release_date', 'NULL'),
            'genres': ', '.join([genre['name'] for genre in data.get('genres', [])]) or 'NULL',
            'budget': data.get('budget', 'NULL'),
            'revenue': data.get('revenue', 'NULL'),
        }
